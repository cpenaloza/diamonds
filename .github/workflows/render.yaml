# Workflow derived from https://github.com/r-lib/actions/tree/v2/examples
# Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
name: render.yaml
on:
  push:
    branches: main
    # paths: ['**.qmd']
permissions: 
  contents: write

jobs:
  render:
    runs-on: ubuntu-latest
    # env:
    #   GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
    # permissions:
    #   contents: write
    steps:
      # Checkout this repo
      - name: Checkout repo

      # Install R
        uses: actions/checkout@v4
        with:
          use-public-rspm: true
          # fetch-depth: 0

      # Install R packages from files/DESCRIPTION
      - uses: r-lib/actions/setup-r-dependencies@v2

      # Install Quarto
      - uses: quarto-dev/quarto-actions/setup@v2

      # Render the querto file into html/
      - name: Render
        run: quarto render index.qmd --output-dir=html

      # Publish html/ to GitHub pages
      - name: Publish to GitHub pages ðŸš€
        uses: JamesIves/github-pages-deploy-action@v4.5.0
        with:
          folder: html      
      #   with:
      #     r-version: renv

      # - uses: r-lib/actions/setup-renv@v2

      # - name: Render Rmarkdown files and Commit Results
      #   run: |
      #     RMD_PATH=($(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '[.]Rmd$'))
      #     Rscript -e 'for (f in commandArgs(TRUE)) if (file.exists(f)) rmarkdown::render(f)' ${RMD_PATH[*]}
      #     git config --local user.name "$GITHUB_ACTOR"
      #     git config --local user.email "$GITHUB_ACTOR@users.noreply.github.com"
      #     git commit ${RMD_PATH[*]/.Rmd/.md} -m 'Re-build Rmarkdown files' || echo "No changes to commit"
      #     git push origin || echo "No changes to commit"